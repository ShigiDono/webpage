# 備考
## 座標系について
### カメラ座標系
カメラ座標系の各基底方向は画像の右、上、手前方向の順である。

### マーカー座標系
マーカー座標系の原点はマーカーの中心。
各基底の方向は右、上、手前方向の順である。

## 焦点距離について
画像の投影面の横の長さが1.0であるとしたときの焦点距離である。
つまり焦点距離が1.0であるときは、画像の横幅と同じ長さだけ離れた位置に射影投影の視点がある。


## positionEstimater.observeMarkers(domElement)
### 概要
domElementから読み込んだ画像からマーカーを検出し、そのマーカーの画像中の位置などからカメラの姿勢に関する情報を取得する。

### 引数
domElement -- 画像、動画、ウェブカメラのdomElement

### 戻り値
result_array -- {markerData}
※markerData 以下のようなキーを持つオブジェクト
* D1 -- マーカー→カメラ（カメラ座標系,焦点距離1.0の場合のもの）
* R1 -- カメラ座標系の基底(各列,マーカー座標系におけるもの)
* GR1 -- カメラ座標系の基底(各列,絶対座標系におけるもの)
* E1 -- D1,R1に対するエラー(整数で0~12あたりの値を取るようであるが、詳細は不明)
* Xm -- マーカー中心位置(絶対座標系)
* Rm -- マーカー座標系の基底(各列,絶対座標系におけるもの)
* id -- マーカーのid

## positionEstimater.averageRotationMatrix(R)
### 概要
各マーカーによるカメラの推定姿勢を平均する
平均を実現する手法としては[参考リンク](http://home.hiroshima-u.ac.jp/tamaki/study/20090924SIS200923.pdf)を参考として特異値分解を用いる手法を採用した。

### 引数
markers -- カメラの姿勢行列をのarray

###戻り値
平均姿勢行列

## positionEstimater.estimate_with_f(R_, Xm, D, n_marker, f)
### 概要
焦点距離が与えられていればマーカーごとの観測によるカメラの推定位置は一意に定まる。
この関数では単に全マーカーの位置の平均によって位置を推定する。

### 引数
R_ -- カメラ座標系の各基底(各列,絶対座標系におけるもの,全マーカーの平均値)
Xm -- マーカー位置のarray(絶対座標系におけるもの)
D -- マーカー→カメラのarray(絶対座標系におけるもの)
n_marker -- マーカーの個数
f -- 焦点距離

### 戻り値
以下のようなキーを持つオブジェクト
* x -- カメラの推定位置
* R -- カメラ座標系の各基底(引数のR_と同じもの)

## positionEstimater.estimate_without_f(R_, Xm, D, n_marker)
## 概要
焦点距離が1.0であるとしたときのカメラ位置に関する情報はカメラの奥行き方向に関する自由度を持っている。
それぞれのマーカーからのカメラ推定位置のばらつきが最小となるような時の焦点距離とカメラ位置を返す

## 引数
R_ -- カメラ座標系の各基底(各列,絶対座標系におけるもの,全マーカーの平均値)
Xm -- マーカー位置のarray(絶対座標系におけるもの)
D -- マーカー→カメラのarray(絶対座標系におけるもの)
n_marker -- マーカーの個数

## 戻り値
以下のキーを持つオブジェクト
* x -- カメラ推定位置(絶対座標系)
* R -- カメラ座標系の各基底(引数R_と同じもの)
* f -- 推定焦点距離